<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users Management - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen">
        <!-- Admin Header -->
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4 shadow-lg">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">üë• Users Management</h1>
                <div class="flex gap-4">
                    <a href="/admin" class="bg-white text-purple-600 px-4 py-2 rounded-lg hover:bg-gray-100">‚Üê Dashboard</a>
                    <a href="/admin/logout" class="bg-red-500 px-4 py-2 rounded-lg hover:bg-red-600">Logout</a>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto p-6">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-600 text-sm">Total Users</p>
                    <p class="text-3xl font-bold text-purple-600">{{ users|length }}</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-600 text-sm">Bronze Members</p>
                    <p class="text-3xl font-bold text-orange-600">{{ users|selectattr('tier', 'equalto', 'bronze')|list|length }}</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-600 text-sm">Silver Members</p>
                    <p class="text-3xl font-bold text-gray-600">{{ users|selectattr('tier', 'equalto', 'silver')|list|length }}</p>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <p class="text-gray-600 text-sm">Gold+ Members</p>
                    <p class="text-3xl font-bold text-yellow-600">{{ (users|selectattr('tier', 'equalto', 'gold')|list|length) + (users|selectattr('tier', 'equalto', 'platinum')|list|length) }}</p>
                </div>
            </div>

            <!-- Users Table -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="p-4 bg-gray-50 border-b">
                    <h2 class="text-xl font-bold">All Users</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">User</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Contact</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Tier</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Points</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Orders</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Total Spent</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Joined</th>
                                <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            {% for user in users %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-3">
                                    <div class="font-semibold text-gray-800">{{ user.name }}</div>
                                    <div class="text-sm text-gray-500">ID: {{ user.id }}</div>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="text-sm text-gray-800">{{ user.email }}</div>
                                    <div class="text-sm text-gray-500">{{ user.phone }}</div>
                                </td>
                                <td class="px-4 py-3">
                                    <span class="px-2 py-1 rounded-full text-xs font-semibold
                                        {% if user.tier == 'platinum' %}bg-purple-100 text-purple-800
                                        {% elif user.tier == 'gold' %}bg-yellow-100 text-yellow-800
                                        {% elif user.tier == 'silver' %}bg-gray-100 text-gray-800
                                        {% else %}bg-orange-100 text-orange-800{% endif %}">
                                        {{ user.tier.upper() }}
                                    </span>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="font-semibold text-gray-800">{{ user.points }}</div>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="font-semibold text-gray-800">{{ user.total_orders }}</div>
                                    {% if user.pending_orders > 0 %}
                                    <div class="text-xs text-orange-600">{{ user.pending_orders }} pending</div>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-3">
                                    <div class="font-semibold text-green-600">KSh {{ "{:,.0f}".format(user.total_spent) }}</div>
                                </td>
                                <td class="px-4 py-3">
                                    <div class="text-sm text-gray-600">{{ user.created_at.strftime('%d %b %Y') }}</div>
                                </td>
                                <td class="px-4 py-3">
                                    <a href="/admin/user/{{ user.id }}" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                                        View Details
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
